name: Build OpenWrt Artifact (x86)

on:
 workflow_dispatch:
jobs:
  build-gccgo:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install gccgo
        run: |
          sudo apt-get update
          sudo apt-get install -y gccgo-go 

      - name: Build with shared libgcc
        run: |
          # Use the 'go' command but force the compiler to be gccgo
          # -shared-libgcc: Links libgcc dynamically (saves size)
          # -O3: Maximum optimization
          go build -compiler gccgo \
            -gccgoflags "-O3 -shared-libgcc -Wl,--strip-all" \
            -o myapp_x86 .
            
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: myapp-x86-gccgo
          path: myapp_x86
